<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body{background:#f6f7f9}
    .admin{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e6e9f0;border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:920px){.row{grid-template-columns:1fr}}
    .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    @media(max-width:920px){.grid-3{grid-template-columns:1fr}}
    .input{display:grid;gap:6px}
    .input input,.input select{border:1px solid #e6e9f0;border-radius:10px;padding:10px 12px}
    .btn{border:1px solid #e6e9f0;border-radius:10px;background:#fff;padding:10px 12px;cursor:pointer}
    .btn.primary{background:#6c1d2c;color:#fff;border-color:#6c1d2c}
    .muted{color:#616a77;font-size:13px}
    .err{background:#fee2e2;border:1px solid #fecaca;color:#991b1b;border-radius:10px;padding:8px 12px;display:none;margin-top:8px}
    .ok{background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;border-radius:10px;padding:8px 12px;display:none;margin-top:8px}
    .disabled-mask{opacity:.5;pointer-events:none}
    .spacer{height:10px}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
    .toolbar .right{margin-inline-start:auto}
  </style>
</head>
<body>

<!-- âœ… Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (ØªÙØ®ÙÙ‰ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©) -->
<div id="adminPanel" style="display: none;">
  <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
  <button id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  
  <div class="admin">
    <div class="toolbar">
      <h2 id="pageTitle" style="margin:0">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
    </div>
    <p class="muted">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ØªÙÙ†Ø´Ø£ ÙˆØªÙØ¯Ø§Ø± Ù…Ù† Ù‚ÙØ¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø·.</p>

    <!-- Auth -->
    <div class="card">
      <div class="row">
        <div class="input">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input id="email" type="email" placeholder="you@example.com" autocomplete="username">
        </div>
        <div class="input">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
        </div>
      </div>
      <div style="display:flex; gap:8px; margin-top:10px; align-items:center;">
        <button id="login" class="btn primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button id="logout" class="btn" style="display:none">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        <div id="who" class="muted" style="margin-inline-start:auto"></div>
      </div>
      <div id="ok" class="ok"></div>
      <div id="err" class="err"></div>
    </div>

    <div class="spacer"></div>

    <!-- Products -->
    <div id="card-products" class="card">
      <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
      <div class="grid-3">
        <div class="input">
          <label>Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
          <select id="catSelect"></select>
        </div>
        <div class="input">
          <label>Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ÙØ±Ø¹ÙŠ</label>
          <select id="subSelect"></select>
        </div>
        <div class="input">
          <label>Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯</label>
          <select id="brandSelect"></select>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <div class="input">
          <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
          <select id="modelSelect"></select>
        </div>
        <div class="input">
          <label>ÙƒÙˆØ¯ SAP</label>
          <input id="sap" placeholder="SAP code">
        </div>
      </div>
      <div class="row">
        <div class="input">
          <label>ÙƒÙˆØ¯ Ø§Ù„Ù…ØµÙ†Ø¹</label>
          <input id="factory" placeholder="Factory code">
        </div>
        <div class="input">
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø®Ø§Ø±Ø¬ÙŠ)</label>
          <input id="imageUrl" placeholder="https://... Ø£Ùˆ assets/products/WC/xyz.webp">
        </div>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
        <button id="saveProduct" class="btn primary">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
        <span id="msg" class="muted"></span>
      </div>
    </div>
  </div>

 <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙˆØ§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª -->
<script type="module">
  import { categories, brands } from './categories-data.js';
  window.categories = categories;
  window.brands = brands;
</script>


  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDmUg1cQ4HTa0wEThuZAncYOwyZRFtnlsU",
      authDomain: "projects-catalog.firebaseapp.com",
      projectId: "projects-catalog",
      storageBucket: "projects-catalog.firebasestorage.app",
      messagingSenderId: "813379257336",
      appId: "1:813379257336:web:b2372449cbe46e15c20c0d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const $ = s => document.querySelector(s);
    const ok = $("#ok"), err = $("#err"), who = $("#who");
    const loginBtn = $("#login"), logoutBtn = $("#logout");
    const formCard = document.getElementById("card-products");
    const categories = window.categories;

    function showOK(t){ ok.textContent=t; ok.style.display="block"; err.style.display="none"; }
    function showERR(e){ console.error(e); err.textContent=(e&&e.message)?e.message:String(e); err.style.display="block"; ok.style.display="none"; }
    function setFormEnabled(en){
      formCard.classList.toggle("disabled-mask", !en);
      [...formCard.querySelectorAll("input,select,button")].forEach(el=>{
        if(el.id!=='logout') el.disabled=!en;
      });
    }

    loginBtn.addEventListener('click', async()=>{
      const email = $("#email").value.trim();
      const password = $("#password").value;
      try{
        await signInWithEmailAndPassword(auth, email, password);
        showOK("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
      }catch(e){ showERR(e); }
    });

    logoutBtn.addEventListener('click', async()=>{
      try{ await signOut(auth); showOK("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"); }catch(e){ showERR(e); }
    });

    onAuthStateChanged(auth, (user)=>{
  const loginSection = document.getElementById("loginSection");
  const adminPanel = document.getElementById("adminPanel");

  if(user){
    // âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    const name = user.displayName || user.email || 'Ù…Ø³ØªØ®Ø¯Ù…';
    who.textContent = `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${name}`;
    loginBtn.style.display = 'none';
    logoutBtn.style.display = '';
    $("#email").disabled = true;
    $("#password").disabled = true;
    setFormEnabled(true);

    // ğŸ‘‡ Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø·
    loginSection.style.display = "none";
    adminPanel.style.display = "block";

  }else{
    // âŒ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    who.textContent = "";
    loginBtn.style.display = '';
    logoutBtn.style.display = 'none';
    $("#email").disabled = false;
    $("#password").disabled = false;
    setFormEnabled(false);

    // ğŸ‘‡ Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¹Ø±Ø¶ ÙÙˆØ±Ù…Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙ‚Ø·
    loginSection.style.display = "block";
    adminPanel.style.display = "none";
  }
});


    function loadCategories(){
      const catSel = $("#catSelect");
      const subSel = $("#subSelect");
      catSel.innerHTML = "";
      subSel.innerHTML = "";
      categories.forEach(c => {
        const o = document.createElement("option");
        o.value = c.name;
        o.textContent = c.name;
        catSel.appendChild(o);
      });
      if(categories.length > 0) fillSubs(categories[0].name);
    }

    function fillSubs(main){
      const subSel = $("#subSelect");
      subSel.innerHTML = "";
      const entry = categories.find(c => c.name === main);
      const subs = entry ? entry.subcategories : [];
      if(subs.length === 0){
        const o = document.createElement("option");
        o.value = "";
        o.textContent = "â€” Ù„Ø§ ÙŠÙˆØ¬Ø¯ â€”";
        subSel.appendChild(o);
      }else{
        subs.forEach(s => {
          const o = document.createElement("option");
          o.value = s;
          o.textContent = s;
          subSel.appendChild(o);
        });
      }
    }

    async function loadBrands() {
      const brandSel = $("#brandSelect");
      brandSel.innerHTML = "";
      try {
        const snap = await getDocs(query(collection(db, "brands"), orderBy("name")));
        snap.forEach(doc => {
          const b = doc.data().name;
          const o = document.createElement("option");
          o.value = b;
          o.textContent = b;
          brandSel.appendChild(o);
        });
      } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª:", e);
      }
    }

    $("#catSelect").addEventListener("change", e => fillSubs(e.target.value));

    $("#saveProduct").addEventListener("click", async ()=>{
      const cat = $("#catSelect").value || '';
      const sub = $("#subSelect").value || '';
      const brand = $("#brandSelect").value || '';
      const model = $("#modelSelect").value || '';
      const sap = $("#sap").value.trim();
      const factory = $("#factory").value.trim();
      const imageUrl = $("#imageUrl").value.trim();
      if(!cat) return showERR("Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ");
      const path = sub ? `${cat} - ${sub}` : cat;
      try{
        const id = `${cat}-${sub || 'general'}-${Date.now()}`;
        const payload = {
          cat, sub, path, brand, model,
          sapCode: sap,
          factoryCode: factory,
          imageUrl,
          sap,
          factory,
          photo: imageUrl,
          createdAt: serverTimestamp()
        };
        await setDoc(doc(db,'products', id), payload);
        showOK("âœ” ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©");
        ["sap","factory","imageUrl"].forEach(k => {
          const el = document.getElementById(k);
          if (el) el.value = "";
        });
      }catch(e){ showERR(e); }
    });

    // Init
    loadCategories();
    loadBrands();
  </script>
</body>
</html>
